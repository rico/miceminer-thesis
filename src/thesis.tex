% Masterthesis 
% Rico Leuthold 2.9.2008
%
%noTeXShop

%---------------------------------------------------------------------------------------------------------
% Document setup
%---------------------------------------------------------------------------------------------------------

% paper format and stylesheet
\documentclass[a4paper,10pt,twoside,headings=small,bibliography=totocnumbered,headsepline]{scrartcl}
%\usepackage[english,german,brazilian]{babel}

% praphic package
\usepackage{graphicx}
\usepackage{wrapfig}

% titlepage
\usepackage{titlepic}

% Font
\usepackage{times}
\usepackage[T1]{fontenc} 
\usepackage[english]{babel}
\usepackage{color}

% captions
\usepackage[format=plain,font=small,labelfont=bf,labelsep=period]{caption}

% orientation
\usepackage{rotating}
\usepackage{lscape}

%math
\usepackage{amsmath}

% used for citations
\usepackage[square, numbers, super]{natbib}

% Links
\usepackage[pdftex,hyperfootnotes=false,pdfborder=0 0 0]{hyperref}
\definecolor{darkgrey}{rgb}{0.2,0.2,0.2}
\hypersetup{
    colorlinks,%
    citecolor=black,%
    filecolor=black,%
    linkcolor=darkgrey,%
    urlcolor=blue
}

\urlstyle{rm}

% tables
\usepackage{tabularx}
\usepackage{ctable}
\usepackage{longtable}
%\usepackage{rotfloat}

% subfigures 
\usepackage{subfig}

% used for source code
\usepackage{listings}
\usepackage{fancyvrb}
\definecolor{lightgrey}{rgb}{0.95,0.95,0.95}

% appendix
\usepackage[toc,page]{appendix}

% heading on every page
\pagestyle{headings}

% Spacing
\frenchspacing

% Math symbols
\usepackage{mathabx} 

% ... some mor spacing stuff
\usepackage{setspace}


% border of pdf pics
\pdfpagebox 4

% Acronyms
\usepackage[printonlyused,withpage,footnote]{acronym}

% Space before and after paragraph title
\makeatletter
\renewcommand\paragraph{\@startsection{paragraph}{4}{\z@}%
  {-1.25ex\@plus -.5ex \@minus -.2ex}%
  {.5ex \@plus .2ex}%
  {\normalfont\normalsize\bfseries}}
\makeatother

%
% CUSTOM COMMANDS
%

% make inline listings normal font size
\makeatletter
\lst@AddToHook{TextStyle}{\let\lst@basicstyle\ttfamily\small\fontfamily{pcr}\selectfont}
\makeatother

% Code style with line numbers 
\newenvironment{numcodestyle}{
	\lstset{basicstyle=\footnotesize, numbers=left, numberstyle=\tiny, numbersep=3mm, stepnumber=1, backgroundcolor=\color{lightgrey}}
}

% Code style without line numbers
\newenvironment{codetiny}{
	\lstset{basicstyle=\tiny, numbers=none, backgroundcolor=\color{lightgrey}}
}

\newenvironment{codefoot}{
	\lstset{basicstyle=\footnotesize, numbers=none, backgroundcolor=\color{lightgrey}}
}

\newenvironment{codescript}{
	\lstset{basicstyle=\scriptsize, numbers=none, backgroundcolor=\color{lightgrey}}
}

% this makes description lists spacing much better.
\newenvironment{mydesc}{
	\begin{description}
	  \setlength{\itemsep}{1pt}
	  \setlength{\parskip}{0pt}
	  \setlength{\parsep}{0pt}
}
{
	\end{description}
}

% this makes description lists spacing much better.
\newenvironment{mylist}{
	\begin{itemize}
      \renewcommand{\labelitemi}{$\sqbullet$}
	  \setlength{\itemsep}{0pt}
	  \setlength{\parskip}{0pt}
	  \setlength{\parsep}{0pt}
}
{
	\end{itemize}
}


% this makes list spacing much better.
\newenvironment{condensed_enum}{
	\begin{enumerate}
	  \setlength{\itemsep}{1pt}
	  \setlength{\parskip}{0pt}
	  \setlength{\parsep}{0pt}
}
{
	\end{enumerate}
}

% this makes list spacing much better.
\newenvironment{condensed_item}{
	\begin{itemize}
      \renewcommand{\labelitemi}{$\circ$}
	  \setlength{\itemsep}{1pt}
	  \setlength{\parskip}{0pt}
	  \setlength{\parsep}{0pt}
}
{
	\end{itemize}
}

% Table column types for bold row 
\newcolumntype{+}{>{\global\let\currentrowstyle\relax}}
\newcolumntype{^}{>{\currentrowstyle}}
\newcommand{\rowstyle}[1]{\gdef\currentrowstyle{#1}%
#1\ignorespaces
}

%===============================
% Start document
%===============================
\begin{document}

% select language
\selectlanguage{english}

% Title page
%\title{Informatic Tools to Explore Social Behavior in House Mice}
%\author{Rico Leuthold}
%\date{\today}  %\today is replaced with the current date
%\maketitle
\begin{titlepage}
\begin{flushleft}
\includegraphics[width=\textwidth]{assets/pdf/title_header.pdf}
\end{flushleft}
\vspace{2cm}
\begin{center}
\includegraphics[width=\textwidth]{assets/pdf/box_title.pdf}
\end{center}


\vfill

% Author and supervisor
\begin{minipage}{0.5\textwidth}
	\begin{flushleft}
		\includegraphics[width=\textwidth]{assets/pdf/title_footer_author.pdf}
	\end{flushleft}
\end{minipage}
\begin{minipage}{0.5\textwidth}
	\begin{flushright}
		\includegraphics[width=\textwidth]{assets/pdf/title_footer_supervisor.pdf}
	\end{flushright}
\end{minipage}
\end{titlepage}

\newpage

% Table of contents
\tableofcontents
\listoftables
% add table of figures to toc
\listoffigures

% ===============================
% Introduction
% ===============================
\include{introduction}

% ===============================
% Biology of the house mice
% ===============================
\include{biology_house_mice}

% ===============================
% Shed setup
% ===============================
\include{shed_setup}

% ===============================
% Data collection
% ===============================
\include{data}

% ===============================
% Data processing
% ===============================
\include{data_processing}

% ===============================
% Data exploration
% ===============================
\include{data_exploration}

% ===============================
% Network exploration
% ===============================
\include{network_exploration}

% ===============================
% Conclusions
% ===============================
\newpage
\section{Conclusions}
\label{sec:concl}

... will see.

%---------------------------------------------------------------------------------------------------------
% Document References
%---------------------------------------------------------------------------------------------------------
\newpage
%\addcontentsline{toc}{section}{References}
\bibliographystyle{plainnat}
\bibliography{references}

% ===============================
% Appendix
% ===============================
\begin{appendix}
\addappheadtotoc
%---------------------------------------------------------------------------------------------------------
% Code
%---------------------------------------------------------------------------------------------------------
\include{code}

%---------------------------------------------------------------------------------------------------------
% Code
%---------------------------------------------------------------------------------------------------------
\newpage
\section{Tables \& schemata}
\label{sec:tables_schmemata}

\begin{figure}[htpb]
\begin{center}
  \includegraphics[width=\textwidth]{assets/pdf/application_design.pdf}
  \caption[Application design]{Overview of the application design.}
  \label{fig:app_design}
\end{center}
\end{figure}


% Micedata database schema
\begin{sidewaysfigure}
  \includegraphics[width=\textwidth]{assets/pdf/micedata_schema.pdf}
  \caption[Database schema]{Database schema including all the tables and the relations between them.}
  \label{fig:database_schema}
\end{sidewaysfigure}

\begin{sidewaystable}{H}
\newcolumntype{H}{>{\bf}lp{2.5cm}}
\caption{Meaning of the \lstinline|i| values in the database tables.}
\begin{tabularx}{\textheight}{+H^X^X^X^X^X}
\toprule
\rowstyle{\bfseries}
	&	\textbf{0}	&	1	&	2	&	3	&	4\\\midrule
data	    &  Dataset has not been analyzed yet.  &  Dataset has been analyzed but no matching dataset to form a \textit{direction result} could be found.	&	Dataset is part of a \textit{direction result} .	&	Dataset is part of a typ \textbf{3} \textit{stay result}.	&	Dataset is part of a typ \textbf{4} \textit{stay result}.\\\midrule

dir     	& \textit{Direction result} has not been analyzed yet. &  \textit{direction result} has been analyzed but no matching \textit{direction result} to form a \textit{stay result} could be found. & -  &  \textit{Direction result} is part of a typ \textbf{3} \textit{stay result}. & \textit{Direction result} is part of a typ \textbf{4} \textit{stay result}.\\\midrule

res     	& - & - & - & \textit{Stay result} is of typ \textbf{3} & \textit{Stay result} is of typ \textbf{4} \\\bottomrule
\label{tab:i_values}
\end{tabularx}

\end{sidewaystable}

% Micedata cheatsheet
\begin{sidewaysfigure}
  \includegraphics[width=\textwidth]{assets/pdf/micedata_data_processing_cheatsheet.pdf}
  \caption[Data processing cheatsheet]{Cheatsheet for the data processing steps.}
  \label{fig:data_processing_cheatsheet}
\end{sidewaysfigure}

\newpage

% Server information 
\subsection{Server information}
\label{subsec:server_information}

\subsubsection{General information}
\label{subsubsec:general_sys_info}
 
\begin{center} 
\newcolumntype{H}{>{\bf}p{2.5cm}}
\renewcommand\arraystretch{1.5}% (MyValue=1.0 is for standard spacing)
\begin{tabularx}{\textwidth}{+>{\raggedleft\arraybackslash}H^X}

\toprule
Model	& 	Dell Inspiron 530 \\\midrule
Processor	&	Intel(R) Core(TM)2 Duo CPU E7200  @ 2.53GHz, 2525 MHz \\\midrule
Memory (RAM)	&	2 GB \\\midrule
Operating system		&	Linux version 2.6.27-7-server  (gcc version 4.3.2 (Ubuntu 4.3.2-1ubuntu11) ) \\\midrule
IP-address	&	130.60.23.6 \\\midrule
Webserver	&	Apache/2.2.9 (Ubuntu) \\\midrule
SSH	&	OpenSSH 5.1p1  \\\midrule
PHP	version	&	5.2.6-2ubuntu4 \\\midrule
Perl version	&	 5.10.0 \\\bottomrule
\end{tabularx}
\captionof{table}{General information about the server}
\label{tab:server_information}
\end{center}

\newpage
% Web addresses
\subsubsection{Web addresses}
\label{subsubsec:urls}

\textbf{Please note that the server is only accessible from within the network of the \textit{University of Z\"urich}.}

\begin{center}
\footnotesize 
%\begin{sidewaystable}{H}
\newcolumntype{H}{>{\bf}p{8.5cm}}
\begin{tabularx}{\textwidth}{+>{\raggedright\arraybackslash}H^X}
%\renewcommand\arraystretch{1.2}% (MyValue=1.0 is for standard spacing)
\toprule
\rowstyle{\bfseries}
Address	&	Description \\\midrule
\url{http://zool-miceminer.uzh.ch}	&	Main Site containing containing a lot of information about the project. \\\midrule
\url{afp://zool-miceminer.uzh.ch}	&	\ac{AFP} access to the server. \\\midrule
\url{smb://zool-miceminer.uzh.ch}	&	\ac{Samba} access to the server. \\\midrule
\url{http://zool-miceminer.uzh.ch/phpmyadmin}	&	Web-based MySQL database administration tool (\href{http://www.phpmyadmin.net}{phpMyAdmin}). \\\midrule
\url{http://zool-miceminer.uzh.ch/amfphp/browser/index.html}	&	\href{http://www.amfphp.org}{amfphp} service browser. \\\midrule
\url{http://zool-miceminer.uzh.ch/webalizer}	&	Webserver traffic analyzer (\href{http://www.webalizer.org}{Webalizer}). \\\midrule
\url{http://zool-miceminer.uzh.ch/miceminer/srcview/index.html}	&	Source of the \textit{miceminer} application. \\\midrule
\url{http://zool-miceminer.uzh.ch/asdoc/index.html}	& \textit{Adobe Flex} \ac{API} documentation of the \textit{miceminer} application. \\\midrule
\url{http://zool-miceminer.uzh.ch/conf/config.xml}	&	XML-based application wide configuration file (special login required). \\\midrule
\url{http://zool-miceminer.uzh.ch/conf/micedata_create.sql}	&	The SQL which are used to create the database structure (special login required). \\\midrule
\url{http://github.com/rico/miceminer-perl/tree/master}	& \ac{GIT} repository of the perl part of the application containing all the source code.\\\midrule
\url{http://github.com/rico/miceminer-thesis/tree/master}	& \ac{GIT} repository of this document including all the LaTeX source files, schemata, etc.\\\bottomrule

\end{tabularx}
\captionof{table}{List of web addresses.}
\label{tab:web_addresses}
%\end{sidewaystable}
\end{center}

% Files and Directories
\subsubsection{Files \& directories overview}
\label{subsubsec:sys_directories}

\lstset{language=bash}

\begin{center}
\footnotesize 
\newcolumntype{H}{>{\bf}p{5cm}}
\renewcommand\arraystretch{1.2}% 1.0 is for standard spacing)
\begin{tabularx}{\textwidth}{+>{\raggedright\arraybackslash}H^X}
\toprule
\rowstyle{\bfseries}
Directory	&	Description \\\midrule
\lstinline|/var/www/mouse|	&	\textbf{Base directory} of the whole project relevant files and folders. \\\midrule
\\
\hline
\multicolumn{2}{|l|}{\textbf{All of the following files and directories are located within the base directory!}} \\
\hline
\\\midrule
\lstinline|conf/conf.xml|	&	The main \ac{XML} configuration file. \\\midrule
\lstinline|import_scripts//|	&	Contains the \ac{BASH} scripts to start the import cascade at a specific script (see \ref{app:import_schedule} on page \pageref{app:import_schedule} for details). \\\midrule
\lstinline|data/|	&	Uploaded but not yet imported data files. \\\midrule
\lstinline|data/cronlogs/|	&	Transcripts created the \ac{perl} scripts involved in the data import process. \\\midrule
\lstinline|data/imported/|	&	After successful import of a data file into the database, the file is moved into this directory.  \\\midrule
\lstinline|miceminer/|	&	The \textit{miceminer} application main files and folders.\\\midrule
\lstinline|perl/cgi|	&	\ac{CGI} scripts written in \ac{perl} which are used by the \textit{miceminer} application. \\\midrule
\lstinline|perl/extras/|	&	Perl scripts to control the data validity in the database and to compile data for some special analysis. The task of these scripts is usually explained in the header section of the file. \\\midrule
\lstinline|perl/import/|	&	Contains the perl script involved in the data import and processing. \\\midrule
\lstinline|perl/lib/|	&	The perl modules needed by all the import, reset and CGI scripts. \\\midrule
\lstinline|perl/reset/|	&	Scripts to set back the data in the database, so that the import scripts can be rerun. \\\midrule
\lstinline|amfphp/services/miceMiner/Mice.php|	&	\href{http://www.amfphp.org/}{amfphp} services file. \\\midrule
\lstinline|asdoc/|	&	Contains the \textit{miceminer} \ac{API} online documentation files. \\\bottomrule
\end{tabularx}
\captionof{table}{Overview of the important files and directories.}
\label{tab:directories_and_files_overview}
\end{center}

% import scripts
\newpage
\subsection{Starting \& scheduling import scripts}
\label{app:import_schedule}

To start the import cascade, a set of \ac{BASH} scripts is provided (see table \ref{tab:directories_and_files_overview} on page \pageref{tab:directories_and_files_overview} for the directoy these scripts are located in). Each of these scripts starts the import cascade at a specific per script and sends a mail including the transcript of the process to \href{mailto:miceminer@gmail.com}{miceminer@gmail.com} upon completion.

\begin{center} 
\newcolumntype{H}{>{\bf}p{5cm}}
\renewcommand\arraystretch{1.2}
\begin{tabularx}{\textwidth}{+>{\raggedright\arraybackslash}H^X}
\toprule
\rowstyle{\bfseries}
BASH script	&	perl script \\\midrule
\lstinline|import_step_1.sh|	&	\lstinline|logimport.pl| \\\midrule
\lstinline|direction_step_2.sh|	&	\lstinline|searchdir.pl| \\\midrule
\lstinline|results_step_3.sh|	&	\lstinline|searchres.pl| \\\midrule
\lstinline|meetings_step_4.sh|	&	\lstinline|meetings.pl| \\\midrule
\lstinline|counter_step_5.sh|	&	\lstinline|counter.pl| \\\midrule
\end{tabularx}
\captionof{table}{Overview of the BASH scripts and the perl import script they start.}
\label{tab:import_bash_scripts}
\end{center}
 
These scripts can be started manually from the command line or through a so called \textit{cronjob} which schedules the execution of the scripts.

\codefoot
\begin{lstlisting}[frame=none]
 # m h  dom mon dow   command
0 23 * * *      /var/www/mouse/import_scripts/import_step_1.sh   
\end{lstlisting}

The above listing shows the actual \textit{cronjob} which starts the import cascade every day at 11 o'clock p.m. beginning with the \lstinline|logimport.pl| script.

% configuration XML
\newpage
\subsection{Configuration}
\label{app:config} 

The application wide configuration is stored in a single XML file. The different possibilities to access or view the file can be found in the \ref{tab:directories_and_files_overview} table and the \ref{tab:web_addresses} table.

Please be careful on what you change. Never move the file to another location or delete it. Some minor knowledge in XML is advantageous to make changes in the configuration. It is strongly recommended to make a backup copy of the original file before applying changes. The file contains some explanations of what can be changed easely and what should not be changed.

\numcodestyle
\lstset{language=XML}    

\subsubsection{Database}
\label{app:configdb}

The following listing shows the part of the XML-configuration file responsible for the database connection to the \textit{MySQL} server. 

The values for the connection are set in the four nodes, \lstinline|<dbname>| contains the database name, \lstinline|<dbuser>| the user name, \lstinline|<dbpass>| the user password and \lstinline|<dbsocket>| the MySQL socket. This allows to switch the database, but only whne the table structures match (see the entry for the SQL file to create the database in table \ref{tab:web_addresses} on page \pageref{tab:web_addresses}).

The mapping to the database tables can be changed by setting the node value to another table, but only when the table structures match.

\subsubsection{Perl}
\label{app:configperl}

The perl part of the XML configuration file.

\lstinputlisting[firstnumber=59,firstline=59, lastline=70, caption=Perl configuration, label=lst:perl_config]{assets/code/config.xml}

\paragraph{scriptsFolder} The directory containing the perl \textit{Import Scripts} (see section \ref{sec:dataproc} on page \pageref{sec:dataproc} for details).

\paragraph{dbBackupUser} A MySQL user with \lstinline|SELECT| and \lstinline|LOCK TABLES| privileges on the database set as the \lstinline|<dbname>| value in the databse configuration (see appendix \ref{app:configdb} on page \pageref{app:configdb}). 

\paragraph{dbBackupDirectory} The directory in which the database backups are saved which are created at the beinning of the data import process.

\paragraph{antennaInterval}
\label{para:perl_antenna_interval}
Number of seconds that are allowed to elapse between the transponder readings at the inner and the outer antenna of box, to form a valid \textit{direction result}. 

\subsubsection{GUI \& PHP}
\label{app:configfrontend}
\lstinputlisting[firstnumber=82,firstline=82, lastline=83, caption={Maximum hours of stay results}, label=lst:stay_config]{assets/code/config.xml}

\lstinputlisting[firstnumber=84,firstline=84, lastline=111, caption={Components configuration}, label=lst:comp_config]{assets/code/config.xml}

Shown in the next listing is the beginning of the configuration for the grids in the GUI. The different part of the configuration is explained on the spot in the configuration file.

\lstinputlisting[firstnumber=418,firstline=418, lastline=468, caption=sample Grid configuration, label=lst:grid_config]{assets/code/config.xml}

The configuration parameter to set the minimal duration of meetings between to mice within the selected month to be included in the data shown in the \textbf{Graph Data} component. 

\lstinputlisting[firstnumber=394,firstline=394, lastline=398, caption=Graph Data component limit value , label=lst:graph_data_limit]{assets/code/config.xml}

%---------------------------------------------------------------------------------------------------------
% Glossary
%---------------------------------------------------------------------------------------------------------
\newpage

\section{Glossary}
\begin{acronym}
\acro{RDBMS}[Relational Database Management System]{A Relational Database Management System is a \acs{DBMS} in which data is stored in the form of tables and the relationship among the data is also stored in the form of tables \cite{wiki:rdbms}.}
\acro{DBMS}[Database Management System]{A Database Management System is computer software that manages databases \cite{wiki:dbms}.}
\acro{RFID}[Radio-frequency identification]{Radio-frequency identification (RFID) is the use of an object (typically referred to as an RFID tag) applied to or incorporated into a product, animal, or person for the purpose of identification and tracking using radio waves \cite{wiki:rfid}}
\acro{SQL}[Structured Query Language]{The Structured Query Language is a database computer language designed for the retrieval and management of data in relational database management systems.\cite{wiki:sql}}
\acro{KJ}[KJ]{The Joule is a derived unit of energy and defined as the work done by a force of one newton travelling through a distance of one metre. \cite{wiki:joule}. 1 Kilo Joule = 10$^3$ Joule.}
\acro{perl}[perl]{Perl is a high-level, general-purpose, interpreted, dynamic programming language. \cite{wiki:perl}}
\acro{PVC}[PVC]{Polyvinyl chloride is a widely used thermoplastic polymer \cite{wiki:pvc}}
\acro{GUI}[GUI]{A graphical user interface is a type of user interface which allows people to interact with electronic devices such as computers [\ldots] with images rather than text commands \cite{wiki:gui}}
\acro{API}[API]{An application programming interface is a set of routines, data structures, object classes and/or protocols provided by libraries and/or operating system services in order to support the building of applications \cite{wiki:api}.}
\acro{AFP}[AFP]{The Apple Filing Protocol is a network protocol that offers file services for Mac OS X \cite{wiki:afp}.}
\acro{Samba}[Samba]{Samba allows file and print sharing between computers running Windows and computers running Unix \cite{wiki:samba}.}
\acro{XML}[XML]{Extensible Markup Language is a general-purpose specification for creating custom markup languages \cite{wiki:xml}.}
\acro{CGI}[CGI]{The Common Gateway Interface is a standard protocol for interfacing external application software with an information server, commonly a web server \cite{wiki:cgi}.}
\acro{BASH}[BASH]{Bourne-again shell is a free software Unix shell written for the GNU Project /cite{wiki:bash}.}
\acro{GIT}[GIT]{Git is a free distributed revision control, or software source code management project /cite{wiki:git}.}
\end{acronym}

\end{appendix}
%---------------------------------------------------------------------------------------------------------
% End Document
%---------------------------------------------------------------------------------------------------------
\end{document}